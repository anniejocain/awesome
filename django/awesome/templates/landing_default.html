{% extends "layouts/base.html" %}
{% load static %}
{% get_static_prefix as STATIC_PREFIX %}

{% block title %}Awesome Box{% endblock title %}

{% block styles %}
<link rel="stylesheet" href="{{ STATIC_PREFIX }}css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" media="all" href="{{ STATIC_PREFIX }}css/landing.css" />
{% endblock styles %}

{% block content %}
<body>
<div class="container">
	
	<div class="row center">
    <div class="text-block opening-row col-md-12">
			<h1>Sometimes things are<br/><span class="awesome">Awesome.</span></h1>
		</div>			
    <img class="awesome-image" src="{{ STATIC_PREFIX }}images/awesome_action.jpg"/>
  </div><!--row-->
  <div class="row">
    <div class="col-md-4 col-md-offset-1">
      <p class="text-block">Checked out something awesome from the library? Return it to the awesome box.</p>
    </div>
    <div class="col-md-3 col-md-offset-2">
      <a href="{% url 'process_self_register' %}" type="button" class="btn btn-custom btn-lg">Get one at your library</a>
      <p><a href="{{ STATIC_PREFIX }}docs/convince-your-library.pdf" class="small convince">Convince your library you need one</a></p>
    </div>	
  </div>

  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row">
    <div class="col-md-4 col-md-offset-1">
  	  <h4>What is the Awesome Box?</h4>
	  <p>It's an alternate returns box that sits alongside your library's regular book drop.</p>
	  <p>If you're returning a book that you thought was awesome, drop it in the Awesome Box instead of the regular book drop. Your librarian will tag it as Awesome and share it with your library community.</p>
    </div>
    <div class="col-md-6">
    	<img class="img-responsive" src="{{ STATIC_PREFIX }}images/flow.png"/>
	</div>
  </div><!--row-->

  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row">
	<div class="col-md-6  col-md-offset-1">
    	<img class="img-responsive" src="{{ STATIC_PREFIX }}images/flow.png"/>
	</div>
    <div class="col-md-4">
	  <h4>Awesome Box is free!</h4>
      <p>Like the greatest public libraries, the Awesome Box is free and open to all.</p>
      <p>Your library owns the data and decides how to implement the box. Awesome Box provides web hosting and a sign and marketing kit.</p>
    </div>
  </div>

  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row">
    <div class="col-md-4 col-md-offset-1">
	  <h4>Your library decides how to use Awesome Box</h4>
      <p>Awesome Box is implemented in your library the way you want it implemented. Your library can set out an Awesome Box and they can decide what happens to the things placed in that box.</p> <p> You can share them on the Awesome Box website (http://your-library.awesomebox.io), through Twitter, using the Awesome Widget, or some other tool that uses the Awesome Box API. Or, heck, maybe you just want to keep it purely physical by putting things dropped in the Awesome Box on an Awesome Box shelf (next to your staff picks shelf). </p>
    </div>
	<div class="col-md-6">
    	<img class="img-responsive" src="{{ STATIC_PREFIX }}images/flow.png"/>
	</div>
  </div>

  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row">
    <div class="col-md-11 col-md-offset-1">
      <!--<p class="text-block-inverse center">These libraries are already awesome.<br >With a lot of awesome items.</p>-->
	  <h1>Over 100 libraries are Awesome Box partners</h1>
      <p class="text-block already">We're getting awesome together</p>
    </div>
  </div>

  <div class="row offerings">
    <div class="col-md-10 col-md-offset-1">
        <div id="plot-map-container"></div>
    </div>
  </div>

  <script type="text/javascript" charset="utf-8">
    // BIG
    //var map, paper, pageWidth=3800;
    var map, paper, branches = [];
    var pageWidth=$('#plot-map-container').parent().width();

    var drawIt = function() {
      paper = new ScaleRaphael('plot-map-container', 950, 650);
      map = paper.USMap();
      paper.scaleAll(pageWidth/map.width);
      function resizePaper(){
        var newWidth = $("#plot-map-container").parent().width();
        paper.scaleAll(newWidth/map.width);
     }
    $(window).resize(resizePaper); 
      $.get("api/v1/branch/?format=json&limit=200&offset=0&callback=?", function(data) {
        branches = data.objects;
        drawPoints(branches);
        });
        function drawPoints(branches) {
            for(var i = 0; i < branches.length; i++){
            //map.plot(points[i][0], points[i][1], points[i][2]);
            //map.darkenState(points[i][3], 0.07);
                map.plot(branches[i]['lat'], branches[i]['long'], branches[i]['organization']['name']);
            }
        }

 // This is for downloading
 /*$("svg").attr({ version: '1.1' , xmlns:"http://www.w3.org/2000/svg"});

 var svg = $("#svggroup").html();
 var b64 = btoa(svg); // or use btoa if supported

 // Works in recent Webkit(Chrome)
 open("data:image/svg+xml," + encodeURIComponent(svg));*/
 // End of downloading

    };

    document.onload = drawIt();
    
  </script>

  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row offerings">
    <div class="col-md-6 col-md-offset-1">
        <h3>Most Awesome of All</h3>
        <p class="text-block already">Of all the items dropped in an awesome box at one of those libraries, these are the most awesome of all</p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4 col-md-offset-1">
    <table class="table table-bordered">
    <thead>
        <tr>
            <th class="small-th">CURRENT RANK</th>
            <th>TITLES</th>
            <th class="small-th">NUMBER AWESOMES</th>
        </tr>
    </thead>
    <tbody>
    {% for item in items %}
        <!--<p class="text-block">{{item.title}}</p>-->
        <tr><td class="rank-td">{{forloop.counter}}</td><td>{{item.title}}</td><td class="awesomes-td">{{item.total_checkins}}</td></tr>
    {% endfor %}
    </tbody>
    </table>
    </div>
    <div class="col-md-4 col-md-offset-1">
        <table class="table table-bordered">
    <thead>
        <tr>
            <th class="small-th">CURRENT RANK</th>
            <th>AUTHORS</th>
            <th class="small-th">NUMBER AWESOMES</th>
        </tr>
    </thead>
    <tbody>
    {% for creator in creators %}
        <!--<p class="text-block">{{item.title}}</p>-->
        <tr><td class="rank-td">{{forloop.counter}}</td><td>{{creator.creator}}</td><td class="awesomes-td">{{creator.total_checkins}}</td></tr>
    {% endfor %}
    </tbody>
    </table>
    </div>
  </div>


  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row">
	<div class="col-md-6  col-md-offset-1">
    	<img class="img-responsive" src="{{ STATIC_PREFIX }}images/flow.png"/>
	</div>
    <div class="col-md-4">
	  <h4>Free? What is the catch?</h4>
      <p>No catch. The Awesome Box is generously supported by the Harvard Library Innovation Lab, the Harvard Library Lab, and the Arcadia Fund.</p>
    </div>
  </div>

  <div class="row landing-section">
    <div class="col-md-10 col-md-offset-1 separator"></div>
  </div><!--row-->

  <div class="row">
    <div class="col-md-4 col-md-offset-1">
	  <h4>Get Awesome at your library</h4>
		<p>Are you a librarian? If so, sign up for an Awesome Box account.</p>
		<p class="text-block already"><a href="{% url 'process_self_register' %}" type="button" class="btn btn-custom btn-lg">Sign up</a> to discover what's Awesome at your library</p>
      <p><a href="{{ STATIC_PREFIX }}docs/convince-your-library.pdf" class="small convince">Convince your library you need one</a></p>
    </div>
	<div class="col-md-6">
    	<img class="img-responsive" src="{{ STATIC_PREFIX }}images/flow.png"/>
	</div>
  </div>

	<footer>
    <div class="row span8 offset2">	
      <a href="http://librarylab.law.harvard.edu/"><img class="left stamp" src="{{ STATIC_PREFIX }}images/liblabstamp.png"/></a>
      <p>Copyright &copy; 2013 The President and Fellows of Harvard College<br><a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a></p>
      		
    </div><!--row-->

  </footer>
</div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript">
	var CSRF_TOKEN = "{{ csrf_token }}";
</script>
<!-- Grab Google CDN's jQuery. fall back to local if necessary --> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src='{{ STATIC_PREFIX }}js/raphael.js'></script>
<script src='{{ STATIC_PREFIX }}js/raphael.scale.js'></script>
<script src='{{ STATIC_PREFIX }}js/g.raphael.js'></script>
<script src='{{ STATIC_PREFIX }}js/usmap.js'></script>
<script src="{{ STATIC_PREFIX }}js/jquery.collagePlus.js"></script>
<script src="{{ STATIC_PREFIX }}js/handlebars.js"></script>
<script src="{{ STATIC_PREFIX }}js/landing.js"></script>
{% endblock scripts %}

{% block templates %}

{% verbatim %}

<script id="items-template" type="text/x-handlebars-template">

<ul> 
	{{#objects}}
	<li class="item">
		<a href="{{branch.organization.catalog_base_url}}{{catalogQuery this}}" target="_blank" >
		{{#if cover_art}}
		<img class="item-cover" src="{{cover_art}}" alt="{{title}}" />
		{{else}}
		<img class="item-cover" src="http://covers.openlibrary.org/b/isbn/{{isbn}}-M.jpg" alt="{{title}}" />
		{{/if}}
			<p class="item-title">
				{{title}}
			</p>
			</a>
	</li>
	{{/objects}}
</ul>
</script>
{% endverbatim %}
{% endblock templates %}
</body>